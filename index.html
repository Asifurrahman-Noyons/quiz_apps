<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Learning App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .hidden { display: none; }
        .fade-in { opacity: 0; transition: opacity 0.5s ease-in; }
        .fade-in.show { opacity: 1; }
        .navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 10; }
        .content { margin-top: 4rem; }
        .quiz-box { margin-top: 2rem; }
        .option {
            transition: background-color 0.3s ease;
        }
        .option:hover {
            background-color: #90cdf4;
        }
        .option.selected {
            background-color: #63b3ed;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <div class="navbar bg-white shadow p-4">
        <div class="flex items-center justify-between">
            <button id="backButton" class="text-blue-600 hidden" aria-label="Go back">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <h1 id="navTitle" class="text-xl font-bold flex-grow text-center">Item List</h1>
            <div id="timer" class="bg-red-600 text-white px-4 py-1 rounded-lg hidden" aria-live="assertive">left</div>
        </div>
    </div>

    <div class="content max-w-3xl mx-auto p-4">
        <div id="contentDisplay" class="hidden mt-4 space-y-4"></div>
        <div id="itemList" class="mt-6 space-y-4"></div>
    </div>

    <script>
        (function() {
            const backButton = document.getElementById("backButton");
            const navTitle = document.getElementById("navTitle");
            const itemList = document.getElementById("itemList");
            const contentDisplay = document.getElementById("contentDisplay");
            const timerDisplay = document.getElementById("timer");

            let currentView = "items";
            let selectedAnswers = [];
            let timer;
            let timeLeft = 0; // Time will be dynamically set

            const items = [
                {
                    "id": "1",
                    "title": "Nouns",
                    "quiz": [
                        {
                            "question": "What is a noun?",
                            "options": ["A person", "A place", "A thing", "All of the above"],
                            "correctAnswer": "All of the above"
                        },
                        {
                            "question": "Which of the following is a noun?",
                            "options": ["Running", "Quickly", "Cat", "Beautiful"],
                            "correctAnswer": "Cat"
                        }
                    ]
                },
                {
                    "id": "2",
                    "title": "Verbs",
                    "quiz": [
                        {
                            "question": "What is a verb?",
                            "options": ["An action word", "A naming word", "An adjective", "A pronoun"],
                            "correctAnswer": "An action word"
                        },
                        {
                            "question": "Which of the following is a verb?",
                            "options": ["Happy", "Fly", "Blue", "Apple"],
                            "correctAnswer": "Fly"
                        }
                    ]
                }
            ];

            renderItems(items);

            function renderItems(items) {
                itemList.innerHTML = "";
                currentView = "items";
                navTitle.textContent = "Item List";
                backButton.classList.add("hidden");
                contentDisplay.classList.add("hidden");
                timerDisplay.classList.add("hidden");

                items.forEach(item => {
                    const itemDiv = document.createElement("div");
                    itemDiv.classList.add("flex", "items-center", "justify-between", "p-4", "border", "rounded-lg", "bg-white", "shadow-md", "hover:shadow-lg", "cursor-pointer", "fade-in");

                    const title = document.createElement("div");
                    title.classList.add("flex-grow", "ml-4", "font-semibold", "text-lg", "text-gray-800");
                    title.textContent = item.title;

                    const arrow = document.createElement("div");
                    arrow.innerHTML = ` 
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7-7 7" />
                        </svg>
                    `;

                    itemDiv.appendChild(title);
                    itemDiv.appendChild(arrow);
                    itemList.appendChild(itemDiv);

                    itemDiv.addEventListener("click", () => {
                        showQuiz(item.quiz);
                    });
                });

                setTimeout(() => {
                    itemList.querySelectorAll('.fade-in').forEach(el => el.classList.add('show'));
                }, 10);
            }

            function showQuiz(quizArray) {
                currentView = "quiz";
                itemList.innerHTML = "";
                navTitle.textContent = "Quiz Time!";
                contentDisplay.classList.remove("hidden");
                timerDisplay.classList.remove("hidden");
                
                // Set time based on number of questions
                timeLeft = quizArray.length * 30; // 30 seconds per question
                timerDisplay.textContent = formatTime(timeLeft);
                contentDisplay.innerHTML = renderQuizContent(quizArray);
                backButton.classList.remove("hidden");
                selectedAnswers = new Array(quizArray.length).fill(null);
                startTimer();

                history.pushState({ view: "quiz" }, "Quiz", "");
            }

            function renderQuizContent(quizArray) {
                let htmlContent = `<div class="quiz-box"><div id="quizForm">`;

                quizArray.forEach((question, index) => {
                    htmlContent += `
                        <div class="border rounded-lg p-6 bg-white shadow question mb-4" data-index="${index}">
                            <h2 class="text-xl font-bold">${question.question}</h2>
                            <div class="options space-y-2">`;
                    question.options.forEach(option => {
                        htmlContent += `
                            <button class="option w-full text-left p-2 rounded bg-gray-100" onclick="selectOption(this, '${question.correctAnswer}', ${index})">
                                ${option}
                            </button>`;
                    });
                    htmlContent += `
                            </div>
                        </div>`;
                });

                htmlContent += `
                    <button type="button" class="mt-4 w-full px-4 py-2 bg-blue-600 text-white rounded" onclick="submitQuiz()">Submit Answers</button>
                </div>
            </div>`;

                return htmlContent;
            }

            function startTimer() {
                timer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = formatTime(timeLeft);
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        alert("Time's up! Submitting your answers.");
                        submitQuiz();
                    }
                }, 1000);
            }

            function formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;

                return `${hours > 0 ? hours + 'h ' : ''}${minutes}m ${secs}s`;
            }

            window.selectOption = function(button, correctAnswer, questionIndex) {
                const questionDiv = button.closest('.question');
                const selectedOption = questionDiv.querySelectorAll('.option');
                selectedOption.forEach(option => {
                    option.classList.remove('selected');
                });
                button.classList.add('selected');
                selectedAnswers[questionIndex] = button.textContent;
                console.log(`Selected answer for question ${questionIndex + 1}: ${button.textContent}`);
            };

            window.submitQuiz = function() {
                clearInterval(timer);
                const results = selectedAnswers.map((selected, index) => ({
                    question: items[Math.floor(index / items[0].quiz.length)].quiz[index % items[0].quiz.length].question,
                    selected: selected,
                    correctAnswer: items[Math.floor(index / items[0].quiz.length)].quiz[index % items[0].quiz.length].correctAnswer,
                }));

                const correctCount = results.filter(result => result.selected === result.correctAnswer).length;
                const incorrectCount = results.length - correctCount;

                contentDisplay.innerHTML = `
                    <h2 class="text-2xl font-bold">Quiz Results</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                        <div class="bg-blue-100 p-4 rounded-lg shadow">Total Questions: ${results.length}</div>
                        <div class="bg-green-100 p-4 rounded-lg shadow">Correct Answers: ${correctCount}</div>
                        <div class="bg-red-100 p-4 rounded-lg shadow">Incorrect Answers: ${incorrectCount}</div>
                        <div class="bg-gray-100 p-4 rounded-lg shadow">Time Taken: ${60 - timeLeft} seconds</div>
                    </div>
                    <h3 class="mt-6 text-lg font-semibold">Review Your Answers:</h3>
                    <div class="mt-2 space-y-4">
                        ${results.map(result => `
                            <div class="p-4 border rounded-lg bg-white shadow">
                                <p class="font-semibold">${result.question}</p>
                                <p class="text-gray-700">Your Answer: ${result.selected || "No answer"}</p>
                                <p class="text-gray-700">Correct Answer: ${result.correctAnswer}</p>
                            </div>
                        `).join('')}
                    </div>
                `;

                contentDisplay.classList.remove("hidden");
                backButton.classList.remove("hidden");

                history.pushState({ view: "results" }, "Results", "");
            };

            backButton.addEventListener("click", () => {
                if (currentView === "quiz") {
                    resetQuizState();
                    renderItems(items);
                } else if (currentView === "results") {
                    contentDisplay.classList.add("hidden");
                    itemList.classList.remove("hidden");
                    navTitle.textContent = "Item List";
                    backButton.classList.add("hidden");
                    currentView = "items";
                }
            });

            window.addEventListener("popstate", (event) => {
                if (event.state && event.state.view === "quiz") {
                    resetQuizState();
                    renderItems(items);
                } else if (event.state && event.state.view === "results") {
                    contentDisplay.classList.add("hidden");
                    itemList.classList.remove("hidden");
                    navTitle.textContent = "Item List";
                    backButton.classList.add("hidden");
                    currentView = "items";
                }
            });

            function resetQuizState() {
                clearInterval(timer);
                timeLeft = 0;
                selectedAnswers = [];
                timerDisplay.textContent = '';
                contentDisplay.innerHTML = '';
            }
        })();
    </script>
</body>
</html>
